<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD Application</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">


       

        <form class="d-flex" role="search">
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
        <li class="nav-item">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">Add</button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <!-- Display your CRUD content here -->
  <!-- For demonstration purposes, a simple table is included -->

  --Customer list--
  <table class="table">
    <thead>
    <tr>
        <th>ID</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Street</th>
        <th>Address</th>
        <th>City</th>
        <th>State</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody id="dataBody">
    
    </tbody>
</table>
</div>


<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit Customer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Your form elements for editing customer data go here -->


        <form id="editForm">
          <div class="mb-3">
            <label for="updatefirstName" class="form-label">firstName</label>
            <input type="text" class="form-control" id="updatefirstName" name="updatefirstName" required>
          </div>

          <div class="mb-3">
            <label for="updatelastName" class="form-label">lastName</label>
            <input type="text" class="form-control" id="updatelastName" name="updatelastName" required>
          </div>

          <div class="mb-3">
            <label for="updatestreet" class="form-label">street</label>
            <input type="text" class="form-control" id="updatestreet" name="updatestreet" required>
          </div>

          <div class="mb-3">
            <label for="updateaddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="updateaddress" name="updateaddress" required>
          </div>

          <div class="mb-3">
            <label for="updatecity" class="form-label">City</label>
            <input type="text" class="form-control" id="updatecity" name="updatecity" required>
          </div>

          <div class="mb-3">
            <label for="updatestate" class="form-label">State</label>
            <input type="text" class="form-control" id="updatestate" name="updatestate" required>
          </div>

          <div class="mb-3">
            <label for="updateemail" class="form-label">Email</label>
            <input type="text" class="form-control" id="updateemail" name="updateemail" required>
          </div>

          <div class="mb-3">
            <label for="updatephone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="updatephone" name="updatephone" required>
          </div>

          
          
        </form> 

        <button type="button"  onclick="editData()"  class="btn btn-primary" id="editData">Save Changes</button>  
      </div>
    </div>
  </div>
</div>


<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">Add Data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Add your form elements for adding data -->
        <form id="addForm">
          <div class="mb-3">
            <label for="firstName" class="form-label">firstName</label>
            <input type="text" class="form-control" id="firstName" name="firstName" required>
          </div>

          <div class="mb-3">
            <label for="lastName" class="form-label">lastName</label>
            <input type="text" class="form-control" id="lastName" name="lastName" required>
          </div>

          <div class="mb-3">
            <label for="street" class="form-label">street</label>
            <input type="text" class="form-control" id="street" name="street" required>
          </div>

          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input type="text" class="form-control" id="address" name="address" required>
          </div>

          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input type="text" class="form-control" id="city" name="city" required>
          </div>

          <div class="mb-3">
            <label for="state" class="form-label">State</label>
            <input type="text" class="form-control" id="state" name="state" required>
          </div>

          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="text" class="form-control" id="email" name="email" required>
          </div>

          <div class="mb-3">
            <label for="phone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="phone" name="phone" required>
          </div>

          
          <button onclick="postData()" class="btn btn-primary">Add</button>

        </form>
      </div>
    </div>
  </div>
</div>


<div id="paginationInfo"></div>
<div id="paginationControls"></div>

<!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom JavaScript -->
<script>

  


function postData() {
  const token = 'eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJnYWphbmFuQGdhbWlsLmNvbSIsImlhdCI6MTcwNjkzNjkyOCwiZXhwIjoxNzA3NTQxNzI4fQ.RrMHTMdyPkL4ud26bj0T_JNGcvNa7ywIQBNthiE3QhsosFEtQ4Xp0nryVlpfvMLH';
  // localStorage.getItem('jwtToken');

  // Ensure you have a valid token before making the request
  if (!token) {
    console.error('JWT token not found.');
    return;
  }

  const postData = {
    firstName: document.getElementById("firstName").value,
lastName: document.getElementById("lastName").value,
street: document.getElementById("street").value,
address:  document.getElementById("address").value,
city :  document.getElementById("city").value,
state: document.getElementById("state").value,
email: document.getElementById("email").value,
phone: document.getElementById("phone").value
    // Add more properties as needed
    // Add more properties as needed
  };

  fetch('http://localhost:8088/customer/addCustomer', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(postData)
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    fetchData();
    console.log('Data posted successfully:', data);
    // Handle the response as needed
  })
  .catch(error => {
    console.error('Error:', error);
    // Handle errors
  });
}


   // Function to fetch data
   function fetchData() {
        // Use JWT token from local storage in the header
        const token = 'eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJnYWphbmFuQGdhbWlsLmNvbSIsImlhdCI6MTcwNjkzNjkyOCwiZXhwIjoxNzA3NTQxNzI4fQ.RrMHTMdyPkL4ud26bj0T_JNGcvNa7ywIQBNthiE3QhsosFEtQ4Xp0nryVlpfvMLH'
        //  localStorage.getItem('jwtToken');
        const headers = {
            'Authorization': `Bearer ${token}`
        };

        // Make API call to fetch data
        fetch('http://localhost:8088/customer/getAllCustomer', {
            method: 'GET',
            headers: headers,
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // Update the table with the fetched data
            // console.log(data);
            updateTable(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }



    // Trigger fetchData() on page load
   
    function updateTable(data) {
        // Clear existing table rows
        const tbody = document.getElementById('dataBody');
        tbody.innerHTML = '';

        let importData = [];

        // Check if data is an object with 'content' property
        if (typeof data === 'object' && data.hasOwnProperty('content')) {
            importData = data.content;
        } else {
            console.error('Invalid data structure:', data);
            return;
        }

        // Iterate over the data and append rows to the table
        importData.forEach(item => {
            const row = document.createElement('tr');

            // Add cells for each property
            const properties = ['id', 'firstName', 'lastName', 'street', 'address', 'city', 'state', 'email', 'phone'];
            properties.forEach(prop => {
                const cell = document.createElement('td');
                cell.textContent = item[prop];
                row.appendChild(cell);
            });
           id= properties[0];

          

          // <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#editModal" onclick="editData(${item.id}")> editModel</button>

            // Add action cell (Edit and Delete buttons)

            const actionCell = document.createElement('td');
actionCell.innerHTML = `<button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#editModal" onclick="editData(${item.id})">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteCustomer(${item.id})">Delete</button>`;

row.appendChild(actionCell);
            //   const actionCell = document.createElement('td');
          

            row.appendChild(actionCell);

            // Append the row to the table
            tbody.appendChild(row);
        });

        // Optionally, you can add pagination controls  
        const paginationInfo = document.getElementById('paginationInfo');
        paginationInfo.innerHTML = `Page ${data.pageNo + 1} of ${data.totalPages}, Total Elements: ${data.totalElements}`;

        // You may add pagination controls here (e.g., Previous, Next buttons)
        // Example:
        const paginationControls = document.getElementById('paginationControls');
        paginationControls.innerHTML = '';
        if (!data.first) {
            const previousButton = document.createElement('button');
            previousButton.className = 'btn btn-secondary';
            previousButton.textContent = 'Previous';
            previousButton.onclick = () => fetchPage(data.pageNo - 1);
            paginationControls.appendChild(previousButton);
        }
        if (!data.last) {
            const nextButton = document.createElement('button');
            nextButton.className = 'btn btn-secondary';
            nextButton.textContent = 'Next';
            nextButton.onclick = () => fetchPage(data.pageNo + 1);
            paginationControls.appendChild(nextButton);
        }
    }
   
    window.onload = function () {
        fetchData();
    };
    


   function deleteCustomer(customerId)
    {

       // Use JWT token from local storage in the header
      //  const token = localStorage.getItem('jwtToken');

        // Use JWT token from local storage in the header
        const token = 'eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJnYWphbmFuQGdhbWlsLmNvbSIsImlhdCI6MTcwNjkzNjkyOCwiZXhwIjoxNzA3NTQxNzI4fQ.RrMHTMdyPkL4ud26bj0T_JNGcvNa7ywIQBNthiE3QhsosFEtQ4Xp0nryVlpfvMLH'
        //  localStorage.getItem('jwtToken');
        const headers = {
            'Authorization': `Bearer ${token}`
        };

        

        // Make API call to fetch data
        fetch(`http://localhost:8088/customer/deleteCustomer/${customerId}`, {
            method: 'DELETE',
            headers: headers
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        // Check if the response has content before trying to parse as JSON
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
            return response.json();
        } else {
            // Handle empty response
            return {};
        }
        })
        .then(data => {
            // Update the table with the fetched data
            // console.log(data);
            // updateTable(data);
            fetchData();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    // Function to edit a customer 

        // For demonstration purposes, you can open a modal with the existing data
        // const customerData = getCustomerDataById(customerId);
        

        
function editData(customerId) {


  getCustomerDataById(customerId)
        .then(customerData => {
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();

            // Populate the edit form with existing data
            document.getElementById('updatefirstName').value = customerData.firstName;
            document.getElementById('updatelastName').value = customerData.lastName;
            document.getElementById('updatestreet').value = customerData.street;
            document.getElementById('updateaddress').value = customerData.address;
            document.getElementById('updatecity').value = customerData.city;
            document.getElementById('updatestate').value = customerData.state;
            document.getElementById('updateemail').value = customerData.email;
            document.getElementById('updatephone').value = customerData.phone;

            console.log(customerData);

            // Open the edit modal
            const modal = document.getElementById('editModal');
            modal.style.display = 'block';

            // Handle the close button in the modal
            const closeButton = modal.querySelector('.btn-close');
            closeButton.addEventListener('click', function () {
                modal.style.display = 'show';
            });

            // Handle the save button click inside the edit modal
            document.getElementById('editData').onclick = function () {
                saveEditedCustomer(customerId);
            };
        })
        .catch(error => {
            console.error('Error fetching customer data:', error);
            // Handle errors
        });

//   // console.log('Customer Data:', customerData);
//         const editModal = new bootstrap.Modal(document.getElementById('editModal'));
//        editModal.show();
      
//        // Populate the edit form with existing data
//         // document.getElementById('updatefirstName').value = customerData.firstName;
//         // document.getElementById('updatelastName').value = customerData.lastName;
//         // document.getElementById('updatestreet').value = customerData.street;
//         // document.getElementById('updateaddress').value = customerData.address;
//         // document.getElementById('updatecity').value = customerData.city;
//         // document.getElementById('updateemail').value = customerData.email;
//         // document.getElementById('updatephone').value = customerData.phone;

//  // Open the edit modal
//  const modal = document.getElementById('editModal');
//     modal.style.display = 'block';

//     // Handle the close button in the modal
//     const closeButton = modal.querySelector('.btn-close');
//     closeButton.addEventListener('click', function() {
//         modal.style.display = 'show';
//     });

//         // Handle the save button click inside the edit modal
//         document.getElementById('editData').onclick = function() {
//             saveEditedCustomer(customerId);
//         };
    }

    // Function to save edited customer data
function saveEditedCustomer(customerId) {
     // Use JWT token from local storage in the header
     const token = 'eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJnYWphbmFuQGdhbWlsLmNvbSIsImlhdCI6MTcwNjkzNjkyOCwiZXhwIjoxNzA3NTQxNzI4fQ.RrMHTMdyPkL4ud26bj0T_JNGcvNa7ywIQBNthiE3QhsosFEtQ4Xp0nryVlpfvMLH'
        //  localStorage.getItem('jwtToken');
        const headers = {
          'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        };

        const updatedData = {
  firstName: document.getElementById("updatefirstName").value,
lastName: document.getElementById("updatelastName").value,
street: document.getElementById("updatestreet").value,
address:  document.getElementById("updateaddress").value,
city :  document.getElementById("updatecity").value,
state: document.getElementById("updatestate").value,
email: document.getElementById("updateemail").value,
phone: document.getElementById("updatephone").value



    // Add more properties as needed
    // Add more properties as needed
  };

  console.log(updateData);


  fetch(`http://localhost:8088/customer/editCustomer/${customerId}`, {
    method: 'PUT',
    headers: headers,
    body: JSON.stringify(updatedData)
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    console.log('Saving edited data for customer with ID:', customerId);
    return response.json();
  })
  .then(data => {
    fetchData();
    console.log('Data posted successfully:', data);
    // Handle the response as needed
  })
  .catch(error => {
    console.error('Error:', error);
    // Handle errors
  });

}

function getCustomerDataById(customerId)
{

    // Use JWT token from local storage in the header
    const token = 'eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJnYWphbmFuQGdhbWlsLmNvbSIsImlhdCI6MTcwNjkzNjkyOCwiZXhwIjoxNzA3NTQxNzI4fQ.RrMHTMdyPkL4ud26bj0T_JNGcvNa7ywIQBNthiE3QhsosFEtQ4Xp0nryVlpfvMLH'
        //  localStorage.getItem('jwtToken');
        const headers = {
          'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        };

        fetch(`http://localhost:8088/customer/getCustomerById/${customerId}`, {
    method: 'GET',
    headers: headers
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    console.log('get data for customer with ID:', customerId);
    return response.json();
  })
  .then(data => {

    const customer = {
                id: data.id || '',
                firstName: data.firstName || '',
                lastName: data.lastName || '',
                street: data.street || '',
                address: data.address || '',
                city: data.city || '',
                state: data.state || '',
                email: data.email || '',
                phone: data.phone || ''
            };

            console.log('Data retrieved successfully for customer with ID:', customerId);
            return customer;
    fetchData();
  })
  .catch(error => {
    console.error('Error:', error);
    // Handle errors
  });

}


  </script>

</body>
</html>
